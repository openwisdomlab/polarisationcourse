---
phase: 05-visual-polish-full-coverage
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/odyssey-world/concepts/wavePlatformConcepts.ts
  - src/components/odyssey-world/concepts/scatteringChamberConcepts.ts
  - src/components/odyssey-world/concepts/interfaceLabConcepts.ts
  - src/components/odyssey-world/concepts/measurementStudioConcepts.ts
  - src/components/odyssey-world/demos/RetardationExplorer.tsx
  - src/components/odyssey-world/demos/RayleighExplorer.tsx
  - src/components/odyssey-world/demos/FresnelExplorer.tsx
  - src/components/odyssey-world/demos/StokesExplorer.tsx
  - src/components/odyssey-world/depth/DemoLayer.tsx
  - src/components/odyssey-world/depth/DepthPanel.tsx
  - src/components/odyssey-world/WorldMap.tsx
  - src/i18n/locales/en.json
  - src/i18n/locales/zh.json
autonomous: true
requirements: [CONT-01, CONT-05]

must_haves:
  truths:
    - "All 6 physics units are represented across the world's regions -- no core polarization concept is missing"
    - "Each new region (Wave Platform, Scattering Chamber, Interface Lab, Measurement Studio) has 2-4 concept definitions with three-layer depth content"
    - "All new concept text is available in both Chinese and English"
    - "New demo explorers load on demand when the demo tab is activated for their concept"
    - "New concepts appear as nodes on the constellation map with categorized connection lines"
  artifacts:
    - path: "src/components/odyssey-world/concepts/wavePlatformConcepts.ts"
      provides: "Wave Platform concept definitions (retardation series, waveplate compensation, Poincare sphere)"
      contains: "registerRegionConcepts"
    - path: "src/components/odyssey-world/concepts/scatteringChamberConcepts.ts"
      provides: "Scattering Chamber concept definitions (Rayleigh polarization, sky polarization pattern)"
      contains: "registerRegionConcepts"
    - path: "src/components/odyssey-world/concepts/interfaceLabConcepts.ts"
      provides: "Interface Lab concept definitions (Fresnel reflection, medium comparison)"
      contains: "registerRegionConcepts"
    - path: "src/components/odyssey-world/concepts/measurementStudioConcepts.ts"
      provides: "Measurement Studio concept definitions (Stokes measurement, DOP, full polarimetry)"
      contains: "registerRegionConcepts"
    - path: "src/components/odyssey-world/demos/RetardationExplorer.tsx"
      provides: "Waveplate retardation slider demo"
    - path: "src/components/odyssey-world/demos/RayleighExplorer.tsx"
      provides: "Rayleigh scattering angle demo"
    - path: "src/components/odyssey-world/demos/FresnelExplorer.tsx"
      provides: "Fresnel reflection coefficients demo"
    - path: "src/components/odyssey-world/demos/StokesExplorer.tsx"
      provides: "Stokes parameter measurement demo"
  key_links:
    - from: "src/components/odyssey-world/depth/DepthPanel.tsx"
      to: "concept files"
      via: "side-effect imports"
      pattern: "import.*concepts/wavePlatformConcepts"
    - from: "src/components/odyssey-world/depth/DemoLayer.tsx"
      to: "demo explorer components"
      via: "DEMO_COMPONENTS lazy registry"
      pattern: "retardation-explorer.*React\\.lazy"
    - from: "src/components/odyssey-world/WorldMap.tsx"
      to: "concept files"
      via: "side-effect imports for constellation"
      pattern: "import.*concepts/wavePlatformConcepts"
---

<objective>
Expand concept coverage from 2 regions (7 concepts) to all 6 regions (~19 concepts) with full three-layer depth content, bilingual i18n, and interactive demo explorers for 4 key concepts.

Purpose: CONT-01 requires all 6 physics units represented. Currently only Crystal Lab (Unit 0/3) and Refraction Bench (Unit 2) have depth content. Wave Platform (Unit 1 modulation), Scattering Chamber (Unit 4 scattering), Interface Lab (Unit 2/3 interfaces), and Measurement Studio (Unit 5 measurement) need concept definitions. CONT-05 requires all student-facing text bilingual.

Output: 4 concept definition files, 4 demo explorer components, updated DemoLayer registry, updated DepthPanel + WorldMap imports, ~200 new i18n keys in en.json and zh.json.
</objective>

<execution_context>
@/Users/jili/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jili/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-depth-layers-content-integration/04-01-SUMMARY.md
@.planning/phases/04-depth-layers-content-integration/04-03-SUMMARY.md
@.planning/phases/05-visual-polish-full-coverage/05-RESEARCH.md

# Reference files for replication patterns:
@src/components/odyssey-world/concepts/conceptRegistry.ts
@src/components/odyssey-world/concepts/crystalLabConcepts.ts
@src/components/odyssey-world/concepts/refractionBenchConcepts.ts
@src/components/odyssey-world/demos/MalusLawExplorer.tsx
@src/components/odyssey-world/demos/BrewsterExplorer.tsx
@src/components/odyssey-world/depth/DemoLayer.tsx
@src/components/odyssey-world/depth/DepthPanel.tsx
@src/components/odyssey-world/WorldMap.tsx
@src/i18n/locales/en.json
@src/i18n/locales/zh.json

# Region definitions for discovery IDs and physics themes:
@src/components/odyssey-world/regions/wavePlatform.ts
@src/components/odyssey-world/regions/scatteringChamber.ts
@src/components/odyssey-world/regions/interfaceLab.ts
@src/components/odyssey-world/regions/measurementStudio.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create 4 region concept definition files with bilingual i18n content</name>
  <files>
    src/components/odyssey-world/concepts/wavePlatformConcepts.ts
    src/components/odyssey-world/concepts/scatteringChamberConcepts.ts
    src/components/odyssey-world/concepts/interfaceLabConcepts.ts
    src/components/odyssey-world/concepts/measurementStudioConcepts.ts
    src/i18n/locales/en.json
    src/i18n/locales/zh.json
  </files>
  <action>
Create 4 concept definition files following the EXACT pattern of crystalLabConcepts.ts and refractionBenchConcepts.ts. Each file exports a typed array of ConceptDefinition and calls registerRegionConcepts() at the module bottom.

**Wave Platform (3 concepts, primary Unit 1: Modulation):**
1. `retardation-series` (discoveryId: 'wave-platform-retardation-series') -- waveplate retardation from 0 to full-wave, showing linear->elliptical->circular->elliptical->linear progression. triggerElementTypes: ['waveplate']. demoComponentId: 'retardation-explorer'. Formulas: Jones matrix for general waveplate, retardation phase delta = 2*pi*d*delta_n/lambda.
2. `waveplate-compensation` (discoveryId: 'wave-platform-compensation') -- combining two waveplates to produce net retardation, Babinet-Soleil compensator concept. triggerElementTypes: ['waveplate']. No demo explorer. Formulas: Jones matrix product for cascaded waveplates.
3. `poincare-sphere` (discoveryId: 'wave-platform-poincare-sphere') -- Poincare sphere as visualization of all polarization states, with waveplate operations as rotations on the sphere. triggerElementTypes: ['waveplate']. No demo explorer. Formulas: Stokes-to-Poincare mapping (S1,S2,S3 as Cartesian coordinates on unit sphere).

**Scattering Chamber (2 concepts, primary Unit 4: Scattering Media):**
1. `rayleigh-polarization` (discoveryId: 'scattering-chamber-rayleigh') -- Rayleigh scattering produces polarized light, strongest at 90-degree scattering angle. triggerElementTypes: ['environment']. demoComponentId: 'rayleigh-explorer'. Formulas: Rayleigh scattering intensity I ~ (1 + cos^2(theta)), degree of polarization = sin^2(theta)/(1+cos^2(theta)).
2. `sky-polarization-pattern` (discoveryId: 'scattering-chamber-sky-pattern') -- sky polarization pattern centered on sun position, maximum polarization at 90 degrees from sun, used by insects for navigation. triggerElementTypes: ['environment']. No demo explorer. Formulas: DOP as function of solar angle.

**Interface Lab (3 concepts, primary Unit 2/3: Interfaces + Transparent Media):**
1. `fresnel-reflection` (discoveryId: 'interface-lab-fresnel') -- Fresnel equations for s and p polarization reflection coefficients, extending Brewster concept from Refraction Bench. triggerElementTypes: ['environment']. demoComponentId: 'fresnel-explorer'. Formulas: r_s = (n1*cos(theta_i) - n2*cos(theta_t))/(n1*cos(theta_i) + n2*cos(theta_t)), r_p formula, R_s = |r_s|^2, R_p = |r_p|^2.
2. `medium-comparison` (discoveryId: 'interface-lab-medium-comparison') -- comparing polarization behavior across different media (glass, water, crystal), connecting refractive index to polarization effects. triggerElementTypes: ['environment']. No demo explorer. Formulas: Snell's law n1*sin(theta_i) = n2*sin(theta_t).
3. `stacked-interfaces` (discoveryId: 'interface-lab-stacked') -- multiple interfaces create interference and cumulative polarization effects. triggerElementTypes: ['environment']. No demo explorer. Formulas: Transfer matrix method for stacked layers.

**Measurement Studio (3 concepts, primary Unit 5: Polarization Measurement):**
1. `stokes-measurement` (discoveryId: 'measurement-studio-stokes') -- measuring Stokes parameters using rotating analyzer + quarter-wave plate, 4-measurement scheme. triggerElementTypes: ['polarizer', 'waveplate']. demoComponentId: 'stokes-explorer'. Formulas: S0=I(0)+I(90), S1=I(0)-I(90), S2=I(45)-I(135), S3=I_RHC-I_LHC.
2. `degree-of-polarization` (discoveryId: 'measurement-studio-dop') -- DOP as measure of how polarized light is, from fully polarized (1) to unpolarized (0). triggerElementTypes: ['polarizer']. No demo explorer. Formulas: DOP = sqrt(S1^2+S2^2+S3^2)/S0.
3. `full-polarimetry` (discoveryId: 'measurement-studio-polarimetry') -- complete polarization measurement using Mueller matrix, connecting all Stokes and Mueller concepts. triggerElementTypes: ['polarizer', 'waveplate']. No demo explorer. Formulas: S_out = M * S_in, Mueller matrix for analyzer.

**Cross-region connections (add to each concept's connections array):**
- retardation-series -> circular-polarization (causal: waveplate retardation produces circular polarization)
- poincare-sphere -> stokes-measurement (analogous: both represent full polarization state space)
- rayleigh-polarization -> fresnel-reflection (analogous: both produce partial polarization from unpolarized light)
- fresnel-reflection -> brewsters-angle (causal: Fresnel equations predict Brewster angle)
- stokes-measurement -> degree-of-polarization (causal: Stokes parameters define DOP)
- full-polarimetry -> malus-law (analogous: Mueller formalism generalizes Malus's Law)

**i18n content:**
Add all concept text to en.json and zh.json under the existing `odyssey.concepts.*` key structure. For each concept, add keys for name, intuition.title, intuition.content, qualitative.title, qualitative.content, quantitative.title, quantitative.content, quantitative.derivation, and formula description keys.

Use academic-accessible tone matching Phase 4 content. Chinese terminology: 相位延迟 (retardation), 波片补偿 (waveplate compensation), Poincare 球 (Poincare sphere), 瑞利散射 (Rayleigh scattering), 天空偏振模式 (sky polarization pattern), 菲涅耳反射 (Fresnel reflection), 介质对比 (medium comparison), 叠层界面 (stacked interfaces), Stokes 参数测量 (Stokes measurement), 偏振度 (DOP), 完整偏振测量 (full polarimetry).

All triggerCondition values MUST be 'discovered' (invisible gating per locked decision from Phase 4).
  </action>
  <verify>
    pnpm run build passes with no TypeScript errors. Grep for registerRegionConcepts in all 4 new files confirms registration. Grep en.json for 'retardationSeries', 'rayleighPolarization', 'fresnelReflection', 'stokesMeasurement' confirms i18n keys exist. Grep zh.json for the same keys confirms bilingual content.
  </verify>
  <done>
    4 concept definition files created with 11 total ConceptDefinitions (3+2+3+3). All concepts have three-layer depth content (intuition/qualitative/quantitative) with formulas. All concept text exists in both en.json and zh.json. All concepts use triggerCondition: 'discovered'. Cross-region connections link new concepts to existing Phase 4 concepts and to each other.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build 4 demo explorers and wire all registrations</name>
  <files>
    src/components/odyssey-world/demos/RetardationExplorer.tsx
    src/components/odyssey-world/demos/RayleighExplorer.tsx
    src/components/odyssey-world/demos/FresnelExplorer.tsx
    src/components/odyssey-world/demos/StokesExplorer.tsx
    src/components/odyssey-world/depth/DemoLayer.tsx
    src/components/odyssey-world/depth/DepthPanel.tsx
    src/components/odyssey-world/WorldMap.tsx
  </files>
  <action>
Create 4 SVG demo explorer components following the EXACT pattern of MalusLawExplorer.tsx (161 lines), CircularPolExplorer.tsx (129 lines), and BrewsterExplorer.tsx (173 lines). Each explorer: pure SVG, uses useDemoSync hook, single slider control, immediate visual feedback, dark panel aesthetic (bg-gray-800 fills, text-gray-300 labels), under ~200 lines each.

**RetardationExplorer.tsx (Wave Platform):**
- Slider: retardation angle 0-360 degrees
- SVG visualization: polarization ellipse morphing as retardation changes. Show input linear polarization on left, waveplate symbol in center, output ellipse on right. Output ellipse animates between linear (0deg) -> right elliptical (45deg) -> right circular (90deg) -> left elliptical (135deg) -> linear rotated (180deg) -> left elliptical (225deg) -> left circular (270deg) -> right elliptical (315deg) -> linear (360deg).
- useDemoSync: sync retardation to nearest waveplate element properties.fastAxis if available

**RayleighExplorer.tsx (Scattering Chamber):**
- Slider: scattering angle 0-180 degrees
- SVG visualization: incoming unpolarized beam from left, scattering medium in center, scattered beam at selected angle. Show polarization state of scattered beam (degree of polarization = sin^2(theta)/(1+cos^2(theta))). At 90 degrees, beam is fully linearly polarized. At 0/180 degrees, beam is unpolarized. Draw intensity polar diagram.
- useDemoSync: sync scattering angle to environment properties if applicable

**FresnelExplorer.tsx (Interface Lab):**
- Slider: incidence angle 0-90 degrees
- SVG visualization: Plot R_s and R_p reflection coefficients vs incidence angle as two curves. Highlight current angle with vertical line. Show Brewster angle where R_p = 0. Draw the incoming/reflected/refracted ray diagram below the plot. Label s and p components with color coding.
- useDemoSync: sync incidence angle to environment properties if applicable
- Note: This extends the Brewster concept from BrewsterExplorer by showing BOTH s and p curves together, not just the Brewster angle zero crossing.

**StokesExplorer.tsx (Measurement Studio):**
- Slider: analyzer rotation angle 0-360 degrees
- SVG visualization: Show a rotating analyzer (line) with intensity readout. Display the 4 measurement positions (0, 45, 90, 135 degrees) as marked positions on a circle. As the slider moves through each measurement position, record the intensity value. Below, show the reconstructed Stokes vector [S0, S1, S2, S3] filling in as measurements are taken.
- useDemoSync: sync analyzer angle to nearest polarizer element rotation if available

**DemoLayer.tsx updates:**
Add 4 new entries to the DEMO_COMPONENTS Record:
```typescript
'retardation-explorer': React.lazy(() => import('../demos/RetardationExplorer')),
'rayleigh-explorer': React.lazy(() => import('../demos/RayleighExplorer')),
'fresnel-explorer': React.lazy(() => import('../demos/FresnelExplorer')),
'stokes-explorer': React.lazy(() => import('../demos/StokesExplorer')),
```

**DepthPanel.tsx updates:**
Add 4 side-effect imports at the top (below existing crystal lab and refraction bench imports):
```typescript
import '@/components/odyssey-world/concepts/wavePlatformConcepts'
import '@/components/odyssey-world/concepts/scatteringChamberConcepts'
import '@/components/odyssey-world/concepts/interfaceLabConcepts'
import '@/components/odyssey-world/concepts/measurementStudioConcepts'
```

**WorldMap.tsx updates:**
Add the same 4 side-effect imports to ensure concept registry is populated for getConceptsForRegion calls (following the existing pattern where crystalLabConcepts and refractionBenchConcepts are imported).
  </action>
  <verify>
    pnpm run build passes with no errors. Grep DemoLayer.tsx for 'retardation-explorer', 'rayleigh-explorer', 'fresnel-explorer', 'stokes-explorer' confirms all 4 registered. Grep DepthPanel.tsx for all 4 side-effect imports. Grep WorldMap.tsx for all 4 side-effect imports. Each demo explorer file exists and exports a default component.
  </verify>
  <done>
    4 demo explorers created (RetardationExplorer, RayleighExplorer, FresnelExplorer, StokesExplorer), each under ~200 lines, pure SVG, with useDemoSync integration. DemoLayer registry has 7 total entries (3 existing + 4 new). DepthPanel and WorldMap both import all 6 concept files via side-effect imports. New concepts appear on constellation map. All 6 physics units have depth content coverage.
  </done>
</task>

</tasks>

<verification>
1. `pnpm run build` succeeds with zero TypeScript errors
2. All 4 concept files exist and export typed ConceptDefinition arrays
3. All 4 concept files call registerRegionConcepts with correct region IDs
4. All concept i18n keys exist in both en.json and zh.json
5. All 4 demo explorer files exist and export default React components
6. DemoLayer.tsx contains 7 DEMO_COMPONENTS entries
7. DepthPanel.tsx has 6 side-effect concept imports (2 existing + 4 new)
8. WorldMap.tsx has 6 side-effect concept imports (2 existing + 4 new)
9. Cross-region concept connections reference valid concept IDs
</verification>

<success_criteria>
- 11 new ConceptDefinitions across 4 regions covering all 6 physics units
- 33 new LaTeX formula entries across quantitative layers
- ~200 new bilingual i18n keys (English + Chinese)
- 4 interactive SVG demo explorers with useDemoSync integration
- All registrations wired (DemoLayer, DepthPanel imports, WorldMap imports)
- Build passes, no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/05-visual-polish-full-coverage/05-01-SUMMARY.md`
</output>
