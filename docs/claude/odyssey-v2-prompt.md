# Odyssey v2 — 沉浸式偏振光学交互体验 · 系统任务描述

## 1. 项目定位

在一个已有的偏振光学教育平台（React 19 + R3F + Zustand + Tailwind v4）中，重构 `/odyssey` 模块为**单页连续 3D 交互体验**。该体验需将 6 个教学单元、23 个物理演示站点编织进一条**无缝的空间叙事**中，用户通过滚动、拖拽、旋转等自然手势探索偏振光从诞生到完整描述的全过程。

核心身份：这不是"带 3D 背景的网页"，而是一个**可交互的物理实验走廊**——3D 场景本身就是内容、就是交互界面、就是教学媒介。

---

## 2. 当前技术资产

### 已有基础
- **23 个 DOM/SVG 演示组件**：每个接受 `difficultyLevel` 属性，包含完整的物理引擎调用、滑条/拖拽控件、实时图表。代码量从 200 行到 900 行不等。
- **物理引擎**：`@/core/physics/unified` 提供 `PolarizationPhysics`（Malus 定律、Fresnel 方程、Stokes/Mueller/Jones 计算等纯函数）。
- **odysseyData.ts**：23 站的完整内容数据——lazy 组件引用、KaTeX 公式字符串、三级理论文本（foundation/application/research）、关键洞察、真实应用案例。
- **R3F 经验**：项目中已有 Canvas（hub 场景）、自定义 GLSL shader（光束管道）、drei `Text` 组件、demand-mode 渲染。
- **动画库**：Framer Motion（DOM 动画）、Lenis（平滑滚动），均已安装且大量使用。
- **后处理**：`@react-three/postprocessing` 已安装（Bloom、Vignette）。

### 当前 v2 骨架（已搭建，需重构）
- 滚动驱动相机沿 Z 轴飞行
- 光束 CatmullRom 管道 + 自定义 shader（流动粒子、Fresnel 辉光）
- 5 类 3D 光学元件占位模型（偏振片碟、晶体块、玻璃面、散射云、仪器八面体）
- drei `<Html>` 锚定的全息 HUD（标题 + 公式 + 简述）
- 底部光谱导航条（SpectralRail）
- Zustand store 管理滚动进度、当前站点、访问记录
- 开场半透明叙事覆盖层
- 站点间叙事文字

---

## 3. 体验目标

### 3.1 第一印象（0–3 秒）
用户进入页面的瞬间必须看到**视觉丰富、有吸引力的场景**——光源、光束、粒子、远处的光学元件一览无余。不允许黑屏、loading 墙或空白等待。

### 3.2 探索动机（3–30 秒）
场景本身必须让用户**本能地想滚动/交互**。方式可以是视觉暗示（远处有发光的未知物体）、叙事引导（文字提示）、或者动态反馈（轻微的自动推进感）。用户无需阅读说明即可开始。

### 3.3 物理涌现（每个站点）
每个站点的核心教学时刻（Aha Moment）必须**从用户操作中自然涌现**，而非从文字中告知。用户先看到现象（光变暗了！分裂了！消失了！），然后才看到解释。公式是**验证而非教学**。

### 3.4 连续世界感
23 个站点必须存在于**同一个空间连续体**中。禁止页面跳转、全屏切换、或断裂的 loading 过渡。从任意站点到相邻站点的过渡必须在视觉和物理上连贯（光束持续流动、环境色渐变、相机平滑运动）。

### 3.5 深度可达性
对于每个物理概念，体验必须支持至少三个层次的深度：
1. **直觉层**：纯视觉/交互，无文字，用户通过操作光学元件感知物理规律
2. **理解层**：简短文字 + 公式 + 实时数据读数，解释用户刚才看到的现象
3. **精通层**：完整的数学推导、Jones/Mueller 矩阵表示、非理想情况讨论

这三层必须**渐进展开**，不能一次性倾倒。

---

## 4. 交互设计要求

### 4.1 场景内交互（Diegetic Interaction）
所有核心交互必须发生在 3D 场景内部：
- 光学元件（偏振片、波片、晶体、棱镜、玻璃面）必须是**可操作的 3D 对象**
- 操作方式可以是拖拽旋转、滚动驱动参数变化、点击切换状态等
- 光束必须**实时响应**元件状态变化（强度、颜色、偏振态、方向）
- 物理数据（角度、强度、Stokes 参数）以**场景内 HUD** 形式呈现，而非独立 DOM 面板

### 4.2 DOM 内容的场景融合
当需要展示 DOM 内容（已有 demo 组件、复杂控件）时：
- 使用 drei `<Html>` 将 DOM 锚定在 3D 空间坐标上
- 容器使用玻璃拟态（glassmorphism）风格，与场景视觉一致
- 内容必须在视觉上**属于场景**，而非**覆盖场景**

### 4.3 导航
- 用户必须能随时知道自己在 23 个站点中的位置
- 用户必须能快速跳转到任意站点或单元
- 导航元素本身不能侵占沉浸式画面（非侵入式设计）

### 4.4 状态保持
- 用户在某个站点的操作（偏振片角度、参数设置）应在短期内保持
- 光束的偏振态应累积反映沿途所有光学元件的效果（物理正确性）

---

## 5. 视觉与审美要求

### 5.1 视觉基调
- **色彩**：深暗背景（`#050510`），6 个单元各有主色调（amber → cyan → violet → emerald → pink → blue），光学元件和 UI 使用对应颜色
- **质感**：物理级发光（Bloom 后处理）、半透明光学材质（`MeshPhysicalMaterial` transmission）、玻璃拟态 UI
- **动态**：所有视觉元素都有微妙的持续动画（呼吸感缩放、缓慢旋转、粒子飘动、光束流动）
- **参考方向**：科幻实验室（sci-fi lab）与 Apple 设计语言的交汇点

### 5.2 性能约束
- 桌面端 ≥ 55fps，移动端 ≥ 30fps
- 仅渲染相机附近的站点元素（视锥体裁剪 + 距离裁剪）
- Instanced 几何体用于重复元素（粒子、箭头）
- 按需渲染模式（demand frameloop + invalidate）

### 5.3 响应式
- 桌面端：充分利用宽屏，HUD 可展示更多信息
- 平板：保持核心体验不变
- 手机：简化 3D 复杂度，触控友好的控件尺寸

---

## 6. 技术架构约束

### 6.1 渲染架构
- **单一 R3F `<Canvas>`** 包含所有 3D 内容
- 滚动驱动层（Lenis）与 3D 渲染层通过 Zustand store 桥接
- DOM 叠加层用于导航和辅助 UI（低 z-index，不阻挡场景）

### 6.2 物理引擎集成
- 所有可视化必须使用 `@/core/physics/unified` 中的物理计算函数
- 光束偏振态使用 Stokes 向量表示，通过 Mueller 矩阵传播
- 每个光学元件有对应的 Mueller 矩阵变换

### 6.3 组件复用策略
- 已有 23 个 demo 组件的**物理计算逻辑**可直接复用
- 已有 demo 组件的 **DOM 控件**（slider、toggle）可抽取并重新包装
- 已有 demo 组件的 **SVG 可视化**被 3D shader 效果替代
- 传统 `/demos/:demoId` 路由保持不变，作为降级入口

### 6.4 状态管理
- Zustand store 管理：滚动进度、相机状态、每站物理参数、解锁进度、交互模式
- `subscribeWithSelector` 实现高效的细粒度订阅
- 探索进度持久化到 localStorage

---

## 7. 内容覆盖范围

### 6 个单元、23 个站点

| Unit | 主题 | 站数 | 核心物理 |
|------|------|------|----------|
| 0 | 偏振基础 | 5 | 电磁波振荡、偏振态类型、偏振片透射、Malus 定律初探、三偏振片悖论 |
| 1 | 调制与测量 | 5 | Malus 定律定量、双折射分光、波片相位延迟、Stokes 参数、Arago-Fresnel 干涉 |
| 2 | 界面反射 | 2 | Fresnel 方程（rs/rp）、Brewster 角完全偏振 |
| 3 | 透明介质 | 3 | 色散双折射（Michel-Lévy 色表）、旋光效应、光学各向异性 |
| 4 | 浑浊介质 | 3 | Mie 散射、Rayleigh 散射（蓝天/红霞）、Monte Carlo 散射模拟 |
| 5 | 全偏振技术 | 5 | Stokes 向量、Mueller 矩阵、Jones 矩阵、偏振计算器、偏振显微术 |

每个站点的内容数据（公式、三级理论文本、关键洞察、真实案例）已完整定义在 `odysseyData.ts` 中。

---

## 8. 质量标准

### 必须达到
- [ ] TypeScript strict 模式零错误
- [ ] 所有物理公式和计算在数学上 100% 正确
- [ ] 首屏 3 秒内呈现有意义的视觉内容（非 loading 占位）
- [ ] 滚动操作流畅、无卡顿，具有物理质感的阻尼和惯性
- [ ] 每个站点的核心物理现象可通过纯交互（无需阅读）被感知
- [ ] 站点间过渡无跳切、无闪烁、无 layout shift

### 应该达到
- [ ] 至少 5 个站点具备完整的 3D 交互式物理演示（非 DOM 面板替代）
- [ ] 光束偏振态的视觉表现与 Stokes 参数物理一致
- [ ] 键盘完全可操作（快捷键导航 + Tab 焦点管理）
- [ ] 移动端触控操作可用

### 可以延后
- [ ] 全部 23 站的深度 3D 交互（可先做 Unit 0 + 1）
- [ ] 声音/触觉反馈
- [ ] 多语言切换（初版可中英混合）
- [ ] 无障碍 screen reader 支持

---

## 9. 反模式（明确禁止）

- **禁止**教科书式布局（左文字右图片，"先读后做"）
- **禁止**全屏 DOM 面板覆盖 3D 场景（面板可有，但必须是场景的一部分）
- **禁止**页面跳转或 route 切换来展示不同站点
- **禁止**用户在没有任何视觉引导下面对空白/黑暗屏幕
- **禁止**物理上不正确的可视化（宁可简化也不能错误）
- **禁止**为了"炫酷"牺牲 60fps 帧率或首屏加载时间
