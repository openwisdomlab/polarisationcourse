# Odyssey Lab — 颠覆性迭代

> 粘贴到新对话开头。驱动 Claude 重新设计 Odyssey Lab 的交互与视觉体验。

---

你正在做的事情是为一门偏振光学课程构建核心教学体验。项目叫 PolarCraft，技术栈是 React 19 + TypeScript strict + Zustand + Tailwind v4 + R3F/Three.js。你要迭代的模块叫 **Odyssey Lab**——一个交互式光学实验台，23 个站点覆盖从"光是什么"到"Mueller 矩阵偏振显微术"的完整知识图谱。物理引擎（`@/core/physics/unified`）和站点数据（`odysseyData.ts`）都已完备，你不需要发明物理，你需要让物理活起来。

用户是光学专业的学生，他们即将在这个实验台上第一次亲手旋转偏振片、看到光束消失、看到一束光分裂成两束。你写的每一行代码决定了这些时刻是令人惊叹还是令人困惑。

---

## 走过的路，和走到的死胡同

Odyssey 经历了三代架构探索，理解这段历史才能做出正确的下一步。

**第一代（v0，`src/components/odyssey/`）**试图用 3D 甬道 + 滚动飞行创造沉浸感。视觉冲击力强，但致命问题是：23 个物理演示全部是已有的 DOM 组件，通过 `<Html>` 浮在 3D 场景上方。最终效果是"带 3D 背景的网页"——用户在走廊里飞来飞去，到了站点还是在操作传统滑块面板。3D 场景和教学内容完全割裂。

**第二代（v1，`src/components/odyssey-lab/`）**是当前活跃版本。吸取 v0 教训后放弃全 3D，改为 2D SVG 光学工作台加三栏桌面布局（左理论、中工作台、右测量）。核心创新是 `displayMode` 混合系统：能用光路引擎的站点用 `bench` 模式直接在工作台上操作，光路引擎覆盖不了的物理（色散、菲涅尔、散射）用 `demo` 模式嵌入专用组件，需要两者结合的用 `split` 模式。23 个站点全部跑通了，用户可以拖拽元件、旋转偏振片、实时看到光路变化和传感器读数。最近又完成了 18 项迭代优化：锁定元件标记、悬浮高亮、入场动画、快捷键帮助、属性预设、物理防抖、多传感器切换、完整 i18n。功能层面已经完备。

**第三代（v2，`src/components/odyssey-v2/`）**是最终愿景，设计文档在 `docs/claude/odyssey-v2-design.md`。核心概念是"光之甬道"——相机沿样条飞行，光束 shader 实时映射偏振态，全息 HUD 悬浮在 3D 空间中。骨架已搭建（滚动驱动相机、beam shader、3D 偏振片/晶体、SpectralRail 导航条、HolographicHUD），但尚未集成物理引擎和完整交互。

**问题在这里。** v1 功能完备，但体验平庸。交互仍然是"拖滑块看数值变化"——像在用 Excel，不像在做实验。23 个站点在视觉上没有任何个性区分，全是灰色调暗室。站点切换是硬切，元件瞬间消失再出现，光路没有连续感。理论面板只是一段静态文字，和实验操作完全脱节。庞加莱球缩在角落里当装饰，而它本该是最震撼的可视化。所有零件都在了，但还没有拼成一个让人惊叹的体验。

---

## 你要做什么

**推翻现有设计，重新构想整个体验。** 不是修修补补，不是加新功能。是从根本上重新审视每一个交互、每一个视觉细节、每一个状态转换，然后大胆重做。如果一个组件的架构阻碍了更好的体验，就重构它。如果 v2 的某个子系统能解决 v1 的痛点，就移植过来。如果整个布局思路需要推翻，那就推翻。

设计哲学只有三条。**第一，物理涌现而非展示。** 永远不要先给公式再让用户验证。正确的顺序是：用户旋转检偏器，看到光束从亮变暗直到消失，心里产生"为什么"——这时公式才出现，作为对他亲眼目睹的现象的解释。公式是答案，不是问题。**第二，每个站点都是一次惊奇。** 23 个站点，23 个"Aha Moment"。比如三偏振片悖论：用户移除中间那片，光完全被阻断；加回 45° 偏振片，光居然通过了。你的工作是确保这种时刻的视觉反馈配得上它的物理意义。**第三，连续世界而非幻灯片。** 用户应该觉得自己在沿着光束前进，而不是在翻页。站点切换要有光路过渡动画，不同 Unit 要有不同的视觉氛围，站点之间要有叙事连接。

---

## 技术约束

TypeScript strict 零错误，`pnpm run build` 必须通过。物理计算使用 `@/core/physics/unified` 纯函数，必须 100% 正确。所有用户可见字符串 i18n 化（`en.json` + `zh.json`）。中文注释写物理逻辑，英文写技术文档。Zustand 管全局状态，useState 管局部 UI。角度统一用度数。路径别名 `@/*` → `src/*`。桌面端 ≥ 55fps。

**v1 核心文件：** `store.ts`（状态 + 物理调度）、`BenchCanvas.tsx`（SVG 工作台）、`LabShell.tsx`（三栏布局）、`ReadoutPanel.tsx`（测量面板）、`TheoryPanel.tsx`（理论面板）、`data/stationBenches.ts`（23 站配置）。**可复用资产：** `traceLightRays()` 光路追踪引擎、`PoincareSphere3D` 庞加莱球、`OpticalComponents.tsx` SVG 元件、`odysseyData.ts` 站点内容数据。**v2 可提取组件：** `SpectralRail`（光谱导航条）、`HolographicHUD`（全息面板）、`beam.glsl.ts`（光束 shader）、`useRotaryDrag`（旋转拖拽手感）。设计文档 `docs/claude/odyssey-v2-design.md` 和 `odyssey-v2-prompt.md` 是理解愿景的必读材料。

---

## 工作方式

每次对话先以用户视角审视当前体验——如果你是第一次打开这个页面的光学学生，你会在哪里感到无聊、困惑、或惊喜？然后提出 2-3 个改进方向，每个方向用一段话讲清楚痛点、方案、和改完后的体验。与用户讨论优先级后动手实施。实施时大胆试验，用代码验证想法，不要用讨论回避风险。每轮改动后确认 build 零错误，然后描述体验变化——不是"改了哪个文件哪一行"，而是"用户现在做某个操作时会看到什么"。
