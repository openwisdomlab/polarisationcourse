# PolarCraft - 偏振光体素解谜游戏

一个基于偏振光物理特性的体素沙盒解谜游戏，将真实的光学原理融入类似《我的世界》的游戏体验中。同时包含一个5单元的偏振光物理教学课程平台。

## 快速开始

```bash
npm install      # 安装依赖
npm run dev      # 启动开发服务器（热重载）
npm run build    # 生产构建
npm run preview  # 预览生产构建
```

## 项目结构

```
polarisation/
├── src/                    # TypeScript 源代码
│   ├── main.ts             # 游戏入口，游戏循环，UI初始化
│   ├── types.ts            # 类型定义，常量，接口
│   ├── World.ts            # 体素世界管理，光传播
│   ├── LightPhysics.ts     # 偏振光物理引擎（四大公理）
│   ├── Renderer.ts         # Three.js 渲染，相机，光可视化
│   └── PlayerControls.ts   # 输入处理，方块放置，玩家移动
├── index.html              # 首页（导航入口）
├── game.html               # 游戏界面和 HUD
├── demos.html              # 交互式演示和课程内容
├── CLAUDE.md               # 开发指南
├── COURSE.md               # 课程大纲（5个单元）
└── README.md               # 本文件
```

### 多页面应用

| 页面 | 功能 | 说明 |
|------|------|------|
| `index.html` | 首页 | 导航到游戏和课程 |
| `game.html` | 游戏 | 完整游戏，包含HUD、控制器、关卡选择器 |
| `demos.html` | 课程 | 交互式物理演示和5单元课程 |

## 核心概念

### 四大物理公理

1. **正交不干涉 (Orthogonality)** - 偏振角相差90°的光可以共存而互不影响
2. **马吕斯定律 (Malus Law)** - 光通过偏振片时，强度 = 原强度 × cos²(角度差)
3. **双折射分叉 (Birefringence)** - 方解石将光分裂成两束垂直偏振的光
4. **干涉叠加 (Interference)** - 同相光叠加增强，反相光叠加抵消

### 光的属性

- **方向**: 6个离散方向（上下东西南北）
- **强度**: 0-15
- **偏振角**: 0°, 45°, 90°, 135°
- **相位**: 正相(+) / 反相(-)

## 方块类型

| 方块 | 功能 | 关键属性 |
|------|------|----------|
| 💡 光源 (Emitter) | 发射指定偏振角的光束 | 偏振角，朝向 |
| ▤ 偏振片 (Polarizer) | 只允许特定角度的光通过 | 偏振角 |
| ↻ 波片 (Rotator) | 旋转光的偏振角度而不损失强度 | 旋转量（45°或90°） |
| ◇ 方解石 (Splitter) | 将光分裂为两束垂直偏振的光 | 朝向 |
| ◎ 感应器 (Sensor) | 检测特定偏振角度和强度的光 | 偏振角，所需强度 |
| ▯ 反射镜 (Mirror) | 反射光线方向 | 朝向 |
| ■ 实体块 (Solid) | 阻挡光线 | - |

## 操作说明

### 移动控制

| 按键 | 第一人称模式 | 等距/俯视模式 |
|------|--------------|---------------|
| WASD | 移动玩家 | 平移相机 |
| 空格 | 跳跃 | - |
| 鼠标 | 环顾 | 相机控制 |
| Q/E | - | 旋转视角（等距） |
| 滚轮 | - | 缩放 |

### 建造控制

| 按键 | 功能 |
|------|------|
| 左键 | 放置方块 |
| 右键 | 删除方块 |
| R | 旋转方块/改变偏振角度 |
| 1-7 | 选择方块类型 |

### 视角控制

| 按键 | 功能 |
|------|------|
| V | 切换偏振视角模式 |
| C | 切换相机模式 |
| G | 切换网格显示 |
| H | 显示/隐藏帮助面板 |

### 相机模式

- **第一人称**: 传统 FPS 控制，带指针锁定
- **等距视角**: 固定角度 3D 视图，可旋转缩放
- **俯视视角**: 正交俯视图，适合规划谜题

### 偏振视角模式颜色

- 🔴 红色 - 0° 水平偏振
- 🟠 橙色 - 45° 斜向偏振
- 🟢 绿色 - 90° 垂直偏振
- 🔵 蓝色 - 135° 斜向偏振

## 教程关卡

| 关卡 | 名称 | 学习内容 |
|------|------|----------|
| 1 | 光与门 | 光源和感应器的基本使用 |
| 2 | 偏振片 | 偏振片如何过滤光线 |
| 3 | 马吕斯定律 | 串联偏振片的强度衰减 |
| 4 | 波片旋转 | 无损旋转偏振方向 |
| 5 | 方解石分光 | 光的分裂与路由 |

## 物理原理

### 马吕斯定律

当线偏振光通过偏振片时：

```
I = I₀ × cos²(θ)
```

其中 θ 是光的偏振方向与偏振片透光轴之间的夹角。

### 双折射

某些晶体（如方解石）具有两个折射率，入射光会分裂成：
- **寻常光 (o光)** - 0° 偏振，继续原方向
- **非寻常光 (e光)** - 90° 偏振，发生折射

### 干涉

两束相同偏振角的光相遇时：
- **同相 (+,+)** - 强度叠加
- **反相 (+,-)** - 强度抵消

## 课程内容

项目包含完整的5单元偏振光物理教学课程：

| 单元 | 主题 | 核心概念 |
|------|------|----------|
| 1 | 光的偏振 | 双折射、马吕斯定律、方解石实验 |
| 2 | 界面反射 | 菲涅耳方程、布儒斯特角 |
| 3 | 透明介质 | 色偏振、旋光性 |
| 4 | 浑浊介质 | 米氏/瑞利散射、偏振特征 |
| 5 | 全偏振测量 | 斯托克斯矢量、穆勒矩阵、应用 |

访问 `demos.html` 体验交互式演示。

## 技术栈

- **TypeScript** - 类型安全的 JavaScript（严格模式）
- **Three.js** - 3D 渲染引擎
- **Vite** - 现代化构建工具

## 设计理念

> "把看不见的几何学变成看得见、摸得着的方块"

游戏的核心在于用简单的规则创造复杂的涌现行为。就像《我的世界》中的红石电路，玩家可以利用偏振光的物理特性构建：
- 光学逻辑门
- 信号复用系统
- 全息投影装置
- 隐形陷阱

## 调试

游戏对象暴露在 `window` 上，可在控制台中使用：

```javascript
window.game.world.getAllLightStates()  // 获取所有光状态
window.game.world.getAllBlocks()       // 获取所有方块
```

## 许可证

MIT License
